---
const { slug, title, foundry } = Astro.props;
const { default: svg } = await import(`../svg/${slug}.svg?raw`);
// make an id for each item based on the title
const id = title.toLowerCase().replace(/\s/g, "-");
---

<article class={`item`}>
  <a class="item__link" href={`/${slug}/`} rel="prefetch">
    <div class="item__img">
      <Fragment set:html={svg} />
    </div>
    <header class="item__header">
      <h2 class="item__title">{title}</h2>
      <p class="item__foundry">By {foundry}</p>
    </header>
  </a>
</article>

<script>
  import { navigate } from "astro:transitions/client";

  // // get all the item__links
  const handleArticleClick = () => {
    let items = document.querySelectorAll(".item__link");

    // loop through each item__link
    items.forEach((item) => {
      // add a click event listener to each item__link inside item
      item.addEventListener("click", (e) => {
        // prevent the default link behavior
        e.preventDefault();
        const href = e.currentTarget.href;
        // preload the page that the href points to
        // fetch(href, { method: "GET", headers: { "astro-preload": "" } });

        navigate(href);

        // fetch(href, { method: "GET" }).then(() => {
        //   console.log("done");
        //   navigate(href);
        // });

        // wait for the page that the href points to to load and then navigate to it
      });
    });
  };

  document.addEventListener("astro:page-load", () => {
    // handleArticleClick();
  });
</script>
